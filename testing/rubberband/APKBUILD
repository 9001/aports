# Contributor: Alexander Edland <alpine@ocv.me>
# Maintainer: Alexander Edland <alpine@ocv.me>
pkgname=rubberband
pkgver=1.8.2
pkgrel=0
pkgdesc="Audio time-stretching and pitch-shifting"
url="https://breakfastquay.com/rubberband/"
arch="all"
license="GPL-2.0-or-later"
options="!check"  # no test suite
makedepends="vamp-sdk-dev openjdk8 libsamplerate-dev libsndfile-dev fftw-dev ladspa-dev"
subpackages="$pkgname-dev $pkgname-java:_java $pkgname-vamp:_vamp $pkgname-ladspa:_ladspa"
source="https://breakfastquay.com/files/releases/rubberband-$pkgver.tar.bz2"
builddir="$srcdir/rubberband-$pkgver"

build() {
	cd "$builddir"
	
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
	
	JAVA_HOME="/usr/lib/jvm/java-1.8-openjdk" \
	make jni
}

package() {
	cd "$builddir"
	make -j1 DESTDIR="$pkgdir" install
}

_java() {
	pkgdesc="Rubberband built for Java hosts"
	local lib="$subpkgdir/usr/lib"
	
	mkdir -p "$lib"
	mv "$pkgdir/usr/lib/librubberband-jni.so" "$lib"
}

_vamp() {
	pkgdesc="Rubberband built for Vamp-SDK hosts"
	local lib="$subpkgdir/usr/lib"
	
	mkdir -p "$lib"
	mv "$pkgdir/usr/lib/vamp" "$lib"
}

_ladspa() {
	pkgdesc="Rubberband built for LADSPA hosts"
	local lib="$subpkgdir/usr/lib"
	local share="$subpkgdir/usr/share"
	
	mkdir -p "$lib" "$share"
	mv "$pkgdir/usr/lib/ladspa" "$lib"
	mv "$pkgdir/usr/share/ladspa" "$share"
}

sha512sums="da677f9a843711c44c52c0153faa62e587ac7c010569523ef4fef7ce941b9d292e566f46147700e496f6cfff4c9f22f9901dcc93f2d701fdb9de152ddac0c3a6  rubberband-1.8.2.tar.bz2"
